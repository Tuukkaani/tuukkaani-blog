+++
title = "H1 - Cyber kill chain"
date = "2025-08-24"
categories = ["pentesting-course"]
+++

---

### x) Additional reading quick summaries.

#### [Darknet Diaries EP144](https://darknetdiaries.com/episode/144/)

Rachel retells her story on how she got into cybersecurity and social engineering. From DEF CON to red teaming banks and even doing social engineering live. Very interesting listen. [(Darknet Diaries 2024.)](https://darknetdiaries.com/episode/144/)

#### [Hutchins et al 2011.](https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf) 

The paper discusses how threat actors are becoming exceedingly more sophisticated, requiring new methodologies to counter these threats more efficiently using the cyber kill chain in the context of defending against said actors. [(Hutchins et al 2011.)](https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf)

#### [Santos et al.](https://www.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00/)

A quick overview of what active reconnaissance is and how it differs from passive recon. Also a quick overview of popular tools used for active recon such as nmap, eyewitness and other such tools. [(Santos et al.)](https://www.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00/)

#### [KKO 2003:36](https://finlex.fi/fi/oikeuskaytanto/korkein-oikeus/ennakkopaatokset/2003/36#OT2_OT0_OT0)

KKO 2003:36 is about a ruling on an unauthorized port scanning of a bank's network by a 17 year old. The perpetrator got fined for 75 000 Finnish marks due to unlawful attempt to breach the banks systems. [(KKO 2003:36.)](https://finlex.fi/fi/oikeuskaytanto/korkein-oikeus/ennakkopaatokset/2003/36#OT2_OT0_OT0)

---

### a) Virtual machine installation

For virtualization I use QEMU/KVM with virt-manager as the GUI.

I installed kali using their installer image running the 2025.2 release, instead of their live QEMU image. After the installation, I ran `sudo apt upgrade` to get the latest packages.

---

### b) Testing kali's connectivity

After disconnecting the machine, I pinged 8.8.8.8 and checked the NetworkManager using ```nmcli``` to see if the interface was connected/disconnected. 

The ping returned 'Network is unreachable'

![Network is unreachable](/tuukkaani-blog/img/h1/kali_disconnected.png)

While the eth0 interface was disconnected. 

![eth0 Disconnected](/tuukkaani-blog/img/h1/kali_disconnected_2.png)

---

### c) Nmapping localhost on a fresh machine

Using ```nmap -T4 -A localhost``` on the disconnected kali machine.

![Results of the nmap on the localhost](/tuukkaani-blog/img/h1/kali_nmap.png)

Nmap allows the user to specify a timing template by using the ```-T``` flag.
These timing templates let the user pick how fast/aggressive the scan is.
Options range from the slowest (T0) to the fastest (T5), or from paranoid to insane, as described on nmap.org [(nmap.org a.)](https://nmap.org/book/performance-timing-templates.html).

The ```-A``` stands for aggressive scan options. It is a quick way to enable the following flags: ```-o -sV -sC --traceroute``` without the need to type all of them out. These flags enable OS detection, version scanning, script scanning and traceroute [(nmap.org b.)](https://nmap.org/book/man-misc-options.html).

The scan shows all of the ports scanned are currently closed.

---

### d) Starting ssh and MariaDB and scanning the ports

I started SSH ```sudo systemctl start ssh``` and MariaDB ```sudo systemctl start mariadb```.
After that, I ran the nmap scan again, now reporting back two open ports and the versions of the services.

![Two open ports on nmap scan](/tuukkaani-blog/img/h1/kali_daemons.png)

The enabling of the services opened up each of their respective ports.

---

### e) Importing the Metasploitable2 image to a virtual machine

I downloaded and imported the Metasploitable2 image to a virtual machine. The installation went smoothly.  

---

### f) Connecting the two virtual machines via. virtual network

I use two networks for the machines.

The default NAT network for kali which has internet access.
Host-only network that both of the machines use to connect to each other and be off the internet.

I looked for a quick guide on the networking xmls and came across a [kvm-networking guide](https://amoldighe.github.io/2017/12/20/kvm-networking/) by Amol Dighe,
which outlined what I wanted to do nicely. Here I only needed this small snippet:

    <network>
        <name>hostonly</name>
        <bridge name="virbr-hostonly" stp="on" delay="0"/>
        <ip address="192.168.100.1" netmask="255.255.255.0">
            <dhcp>
                <range start="192.168.100.2" end="192.168.100.254"/>
            </dhcp>
        </ip>
    </network>

Then I used ```sudo virsh net-define /path/to/network.xml``` to add the virtual network to libvirt.

And enabled autostart with ```sudo virsh net-autostart hostonly```

[(Amol Dighe 2017.)](https://amoldighe.github.io/2017/12/20/kvm-networking/)


NOTE 2025-10-02

I switched to just using bridges. One bridge that uses my real actual ethernet and one that has zero interfaces as children. This has simplified the networking and the usage of firewalls.

---

### g) Testing the virtual network using nmap

```nmap -sn``` seems to find the target machine just fine.

![Successful ping](/tuukkaani-blog/img/h1/kali_ping.png)

And we can load the front page as well.

![Metasploitable frontpage](/tuukkaani-blog/img/h1/kali_sploit.png)

---

### h) Scanning and analyzing the ports on the metasploitable2 machine. 

Scanning the target machine with ```nmap -A -T4 -p-``` gives multiple open ports, of which, most services are out of date.

For the three ports to focus I picked:

#### 22 / SSH

Could be used to gain remote access.

#### 21 / FTP

Could be used to upload malicious files. 

#### 80 / HTTP

Could be a login/admin page or other possible avenue for user inputs.

---

### Sources used

The assignment which this page is based on can be found here: [Tero Karvinen](https://terokarvinen.com/tunkeutumistestaus/)

[Darknet Diaries 2024. EP144.](https://darknetdiaries.com/episode/144/)

[Hutchins et al 2011.](https://lockheedmartin.com/content/dam/lockheed-martin/rms/documents/cyber/LM-White-Paper-Intel-Driven-Defense.pdf)

[Santos et al.](https://www.oreilly.com/videos/the-art-of/9780135767849/9780135767849-SPTT_04_00/)

[KKO 2003:36](https://finlex.fi/fi/oikeuskaytanto/korkein-oikeus/ennakkopaatokset/2003/36#OT2_OT0_OT0)

[nmap.org a.](https://nmap.org/book/performance-timing-templates.html)

[nmap.org b.](https://nmap.org/book/man-misc-options.html)

[Amol Dighe 2017.](https://amoldighe.github.io/2017/12/20/kvm-networking/)

