+++
title = "H3 - Certificates & Web vulnerabilities"
date = "2025-09-08"
categories = ["pentesting-course"]
+++

# H3

---

### ab) Setting up ZAP and FoxyProxy

I installed ZAP using ```sudo apt install zaproxy``` and started it. Then I installed the FoxyProxy Standard extension for firefox.
In the foxyproxy settings I created the following proxy as mentioned in the guide. Lastly, I added portswigger and localhosts patterns.

![foxyproxy settings](img/h3/foxyproxy.png)

![Patterns](img/h3/patterns.png)

Then I download and import the certificate by navigating to http://zap/ and clicking the download link.
After which I go to firefox's settings and import the cert file.

![cert settings](img/h3/firefoxcerts.png)

![Import cert](img/h3/certimport.png)

Only the specified patterns are using the proxy.

![Proxy](img/h3/sites.png)


[(Vasileiadis 2024.)](https://medium.com/@redfanatic7/complete-owasp-zap-guide-384a080ff502)

---

### cde) XSS

To get a quick idea of XSS attacks, I decided to go on Youtube to see if there are any good and quick videos about the concept.
I came across IBM Technology's video. It is a good video, but I also accidentally just spoiled the solutions to the first two labs.

In the first lab, I did a search with following input ```<script>alert("Your JS here.")</script>```.
This gave me the alert.

In the next lab, I did pretty much the same, but this time I put the same line of code in to the comment's text field.

![XSS Comment](img/h3/commentxss.png)

In both cases, even if the video wouldn't have mentioned it. Here I would have tried to look for possibilities for user input.
When doing black-box type of labs, I often first check if I can upload malicious files through the site or do SQL-injections etc. They can often be easy and fast to do.
Here the same kind of logic applies, where the website has some sort of user input and there are no proper validations or checks in place.

How it works in this case is by injecting code into the website or its database. 

Here is a benign search:

![Safe search](img/h3/safesearch.png)

As the server responds and gives the user the updated webpage, the text can be seen in the site's html.
Now if the site doesn't properly sanitize the user input we can try to inject a ```<script>``` tag.

![Unsafe search](img/h3/unsafesearch.png)

The user now gets a response from the server with unwanted javascript code. In this case the code is simply promoting my amazing movie idea about 
team of roosters playing soccer while Ben Stiller is their coach. The code could also do something more malicious (if that's even possible). For example, defacing the website or redirect the user to a phishing site. In case of both of these labs, the user gets served a webpage with unwanted javascript within it.

[(IBM Technology 5.11.2024)](https://www.youtube.com/watch?v=z4LhLJnmoZ0)

---
### fgh) File path traversal

#### File path traversal, simple case

Here my first taught is to get the server to return me wrong information by simply asking the server for it.
I copy one of the image links and change the filename to be absolute path /etc/passwd and use ```curl *site path*/image?filename=/etc/passwd -o pass.txt```.

![No files](img/h3/firstcurl.png)

After which I decide to see if I am understanding something wrong or if there is a specific method to the madness. I google path traversal and go to [owasp's web site](https://owasp.org/www-community/attacks/Path_Traversal). There I scroll quickly through and come across Examples. There I see I could also try ***traversing***
through the file system. I didn't really think about where in the file system I was before, so with this in mind. I decide to try again, 
```curl *site path*/image?filename=../../../../../../../../etc/passwd -o passnew.txt```. I will not assume the file location so I will just spam a couple ../
to make sure I am at the root of the system. [(OWASP.org. Path Traversal.)](https://owasp.org/www-community/attacks/Path_Traversal)

![Passwd](img/h3/passwd.png)

This time we get the file. Now I'll do the same in ZAP by making a request. I copy a request made for the image file and modify it to ask for /etc/passwd instead.
I realise I get back ```Content-Type: image``` which isn't very useful.

![Content Image](img/h3/zaprequest.png)

I am assuming I need to modify the response as well. So I decide to see how I can intercept and modify these using ZAP and found an old video by webpwnized where they go over using ZAPs breakpoints to stop and modify requests and responses. [(webpwnized 20.1.2018.)](https://www.youtube.com/watch?v=fa5LAfXmwoo)

With this in mind, in ZAP I turn on breakpoints for all requests and responses by using the button marked with the red arrow.
In the UI, the button is green by default and will turn red when on.

![ZAP breakpoints](img/h3/breakpoints.png)

Now I will open one of the sites images in a new tab. I get the request I am sending and modify the filename accordingly.

![First break](img/h3/break.png)

Then after stepping few times, we get the response and modify it to have the ```Content-Type: text/plain``` so we get something readable.

![Response breakpoint](img/h3/breaktwo.png)

After which we step and the page loads. This time we get the passwd in plain text form so its readable.

![Passwd page](img/h3/passpage.png)

#### File path traversal, traversal sequences blocked with absolute path bypass

Here again I did the same ```curl *site path*/image?filename=/etc/passwd -o pss.txt``` I did before. This time it just worked and I got the passwd file.
The same can be done with ZAP following the earlier steps but with the new file path. Here we didn't need to use any traversal sequences due to being
able to access the file with absolute path.

![Passwd content](img/h3/pss.png)

#### File path traversal, traversal sequences stripped non-recursively

Once again I did the same ```curl *site path*/image?filename=/etc/passwd -o pss.txt``` I did before. Now we get 'No Such file' once more.
I try spamming ../../../../../../../ but on luck this time either. I decide to actually read the text next to the ACCESS THE LAB button.
It reveals that the site strips path traversal sequences from user supplied files. So I refer again to [OWASP.org](https://owasp.org/www-community/attacks/Path_Traversal)
and find request variations where we can try to use encoding to bypass a simple traversal sequence check.

I decide to use ```curl *site path*/image?filename=%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd -o pss.txt``` but to no avail.
Next I tried the same but with different encoding using '..%c0%af' but that didn't work either. After none of these worked,
I started assuming, that encoding wasn't the way I was suppose to go about it.

After a while I decide to see what the actual solution to the problem is. Apparently the site simply just looks for instances of '../' and removes them.
In which case we can use a simple doubling up to get past this. I do remember doing something along these lines before and kinda feel silly
not considering something as simple as this. 
After doing ```curl *site path*/image?filename=....//....//....//....//....//etc/passwd -o pass.txt``` we get the file.

#### How to avoid path traversal

For these three cases the filenames should be sanitized well. Firstly recursively remove traversal sequences or just not allow
any type of weird characters. Make sure the files come from appropriate locations and are of the correct type. Ideally limit the user input
to very select cases that are approved. 

---

### i) Insecure direct object references

So for this lab I need to get Carlos' account credentials. Here we have a chat and we can download the chat history.
The lab tells that the chat history is stored on the file system and uses static html pages. I've seen quite a few times
pages where things are accessible with just guessing some URLs. So I type random gibberish into the chat and download it.
Then do the same again. The numbers seem to just go up by one so earlier chats should be just numbers before my first chat.
So I send a request to get me the chat file 1 and there we can find a conversation between whom we assume to be Carlos and Hal.

![Passwords in the chat](img/h3/chat.png)

And there it is. After we just use Carlos as the username and the password and get a successful log in.

#### How to avoid

Instead of plain and direct ways to access files. They should use more complex generated strings and have
proper authentication and permissions for said files. The user shouldn't decide what to access.

---

### x) Extra reading

#### OWASP Top 10 from 2021

The page goes quickly over some common broken access control vulnerabilities and how to prevent them.
These usually include some form of misconfiguration or lack of proper user authentication.
Default state should be inaccessible and authorization and checks should be done before 
anything could be accessed. (OWASP 2021.)

#### Insecure direct object references

The article goes over insecure direct object references. These are instances where
user has the capability to choose access a file by user input. On top of this proper
authentication is also lacking where the user can access files not related to their account.
There are two examples of this, one where the user might be able to access other customer's account
by changing the url's ***customer_number*** to a different number. The other one is similar to the IDOR lab. (Portswigger a.)

#### Path traversal

This time the page goes over some of the labs done earlier and explains briefly why they can go past
some basic checks and how to try to prevent this. Mostly as I the things I listed previously.
But it is also encouraged to just make the app not use user input for file system APIs. Which makes sense.
(Portswigger b.)

#### Cross-site scripting

Here we are introduced to what cross-site scripting is, how it's different types function,
how they can be used for malicious purposes and how that can impact the target. 
It gives the general idea on how to test for possible XSS attacks and how to try to prevent them.
(Portswigger c.)

---

### Sources

All the assignments this page is based on can be found at [Tero Karvinen](https://terokarvinen.com/tunkeutumistestaus/)

[Vasileiadis A. 2024. Complete OWASP ZAP Guide.](https://medium.com/@redfanatic7/complete-owasp-zap-guide-384a080ff502)

[IBM Technology 5.11.2024. Cross-Site Scripting: A 25-Year Threat That I Still Going Strong.](https://www.youtube.com/watch?v=z4LhLJnmoZ0)

[OWASP.org. Path Traversal](https://owasp.org/www-community/attacks/Path_Traversal)

[webpwnized 20.1.2018. How to Intercept HTTP Requests with OWASP ZAP](https://www.youtube.com/watch?v=fa5LAfXmwoo)

[OWASP 2021. OWASP Top 10:2021](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

[Portswigger a. Insecure direct object references (IDOR)](https://portswigger.net/web-security/access-control/idor)

[Portswigger b. Path traversal](https://portswigger.net/web-security/file-path-traversal)

[Portswigger c. Cross-site scripting](https://portswigger.net/web-security/cross-site-scripting)
